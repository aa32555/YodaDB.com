ZAA02GINT13D 
BEG S OS=$S($D(^ZAA02G("OS")):^("OS"),1:"") Q:OS=""  S A=$T(DATA),T=$P(A,";",2) W !?5,$P(A,";",3),?50,"Initialize? (Y or N) " R A#5 S A=$E(A) Q:A=""!("Yy"'[$E(A))
ENT W !,?8,"Initializing ",T S M=0,^ZAA02G(0,T,M)="",H=""
	F I=1:1 S A=$T(DATA+I) S C=$P(A,";",2,99) Q:C=""  F J=1:2:$L(C,"\")-1 S D=$P(C,"\",J),E=$P(C,"\",J+1),X="X="_E,@X,^ZAA02G(0,T,D)=X W "." S Y=",ZAA02G("""_D_""")="_E S:$L(H)+$L(Y)>240 ^(M)="S "_$E(H,2,255),M=M+1,H="" S H=H_Y
	S:H'="" ^(M)="S "_$E(H,2,255) S ^("fon")=$C(27,80,49,125),^("fof")=$C(27,92,183)
	S ^("fost")="S X=$C(P4>94*32+P4+33,P1>94*32+P1+33,P2>94*32+P2+33,P3>94*32+P3+33)",^("foft")="S P4=$A(JJ)>159*-32+$A(JJ)-33,P1=$A(JJ,2)>159*-32+$A(JJ,2)-33,P2=$A(JJ,3)>159*-32+$A(JJ,3)-33,P3=$A(JJ,4)>159*-32+$A(JJ,4)-33"
FNC S ^ZAA02G(.1,T,1)="W *27,""*<"",*27,"")0"" D KEYS^ZAA02GINT13D"
	; S ^ZAA02G(.1,T,1)="W *27,""[1 ~"",*27,""[?7;8h"",*27,""[?1;4;68l"",*27,""[4l"",*27,""*<"",*27,"")0"",*27,""}"" D KEYS^ZAA02GINT13D"
	S ^(7)="W *27,*91,""?3h""\W *27,*91,""?3l""\$C(27)_""[4h""_$C(27)_""[?7l""\$C(27)_""[4l""_$C(27)_""[?7h"""
	S ^(2)="27,91,54,126`27,91,53,126`27,91,51,51,126`27,91,75`27,91,77`27,79,82`27,91,51,55,126`27,91,49,56,126`27,91,90`27,79,80`27,91,51,54,126`27,79,83`27,91,49,55,126`27,91,51,49,126`27,91,51,50,126"
	S ^(3)="```````````````27,79,81`27,91,50,48,126`27,91,51,52,126`27,91,50,49,126`27,91,72`27,91,49,57,126`27,91,51,53,126```27,91,49,126`1`5`6"
	S ^(5)="ERASE EOF`CLEAR`SHIFT F8`SHIFT F5`F5`F3`SHIFT F3`F7`SHIFT TAB`F1`SHIFT F1`F4`F6`SHIFT F6`SHIFT F7",^(6)="```````````````F2`F9`SHIFT F9`F10`HOME`F8`SHIFT F10`INSERT`DEL`BACK TAB`Ctrl A`Ctrl E`Ctrl F"
CLNUP D @(OS_"^ZAA02GINTRM") Q
KEYS W *27,"P1;1|" S l=36 F i=12,14 W i,"/1B5B",$$HEX(l\10+48),$$HEX(l#10+48),"7E" S l=l+1 W:i'=20 ";"
	W *27,"\"
	W *27,"P1;1%|2/1B5B",$$HEX(3+48),"7E",*27,"\" Q
	;
HEX(x) Q $E("0123456789ABCDEF",x\16+1)_$E("0123456789ABCDEF",x#16+1)
DATA ;3153;IBM 3153 in VT220 Emulation
	;BO\$C(27,91,53,109)\BI\$C(118)\BLC\$C(109)\BF\$C(27,91,50,53,109)\BRC\$C(106)\C\$C(56,48)\CL\$C(27,91,75)\CS\$C(27,91,74)\D\$C(27,91,66)\DL\$C(27,91,80)\F\$C(27,91,50,74,27,91,72)\IL\"$C(27,91,76)"\DT\"$C(27,91,77)"\G0\$C(15)\G1\$C(14)
	;H\$C(27,91,72)\HI\$C(27,91,49,109)\HL\$C(113)\IN\$C(27,91,64)\L\$C(27,91,68)\LI\$C(116)\LO\$C(27,91,50,50,109)\P\"$C(27,91)_%R_"";""_%C_""H"""\
	;R\$C(50,52)\RI\$C(117)\ROF\$C(27,91,50,55,109)\RON\$C(27,91,48,55,109)\RT\$C(27,91,67)\SET\$C(27,41,48,27,91,51,49,108)\TI\$C(119)\TLC\$C(108)\TRC\$C(107)\
	;U\$C(27,91,65)\UF\$C(27,91,50,52,109)\UO\$C(27,91,48,52,109)\V\$C(49)\VL\$C(120)\X\$C(110)\Z\$C(27,91,59,49,109)\SR\"$C(27,91)_%R_"";""_%C_""r"""\CSR\"$C(27,91,114)"
	;UK\$C(27,91,65)\DK\$C(27,91,66)\RK\$C(27,91,67)\LK\$C(27,91,68)\INK\$C(27,91,50,126)\DLK\$C(27,91,51,126)
	;
NATION ;G1\$C(27,110)\SET\$C(27,126,27,42,48)
NEW K A S A="",B=^ZAA02G("XLAT",1) F K=1:0 S L=$A(B,K) Q:L<1  S E=$E(B,K+1,K+L),K=K+L+1,L=$A(B,K),F=$E(B,K+1,K+L),K=K+L+1,A(F)=E
	S B(1)="",A="",C=^ZAA02G(.1,3153,2),L=1  F M=1:1:28 S:M=16 C=^(3),L=2,B(L)="" S D=$P(C,"`",M),D=$G(A($C(D))),E="" X "F G=1:1:$L(D) S E=E_$A(D,G)_$S(G=$L(D):"""",1:"","")" S:E="" E=$P(C,"`",M) S $P(B(L),"`",M)=E
	Q
	;